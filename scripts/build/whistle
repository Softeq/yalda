#!/usr/bin/env bash

set -e
# set -x
export YALDA_MODE="build"

source "${ROOT_DIR}/scripts/env"

source "${SCRIPTS_DIR}/utils"

chdir "${ROOT_DIR}"

function _install {
	rm -rf "${YALDA_OUT_WHISTLE}"
	cp ${WHISTLE_DIR}/*.ko "${YALDA_OUT_WHISTLE}"
}

function _build {
	if [ ! "${WHISTLE_BUILD}" == "y" ]; then
		return
	fi

	chdir "${WHISTLE_DIR}"
	make KERNEL_DIR="${KERNEL_DIR}" USE_DKMS=n
	ret

	_install
}

ret